<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Multi-Tape Turing Machine Visualizer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#2563eb;
  --accent:#22d3ee;
  --bg:#f8fafc;
  --card:#ffffff;
  --panel:#ffffffb3;
  --text:#1e293b;
  --muted:#64748b;
  --border:#cbd5e1;
  --radius:14px;
  --tape-bg:#f1f5f9;
  --cell:#ffffff;
  --head:#2563eb;
  --log-bg:#0f172a;
  --log-text:#e2e8f0;
}

/* Dark theme variables */
body.dark{
  --primary:#3b82f6;
  --accent:#22d3ee;
  --bg:#0f172a;
  --card:#1e293b;
  --panel:#1e293bdd;
  --text:#f1f5f9;
  --muted:#94a3b8;
  --border:#334155;
  --tape-bg:#0f172a;
  --cell:#1e293b;
  --head:#22d3ee;
  --log-bg:#020617;
  --log-text:#e5e7eb;
}

*{box-sizing:border-box;}
body{
  font-family:'Inter',sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  display:flex;
  flex-direction:column;
  min-height:100vh;
  transition:background 0.3s,color 0.3s;
}
header{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 28px;
  box-shadow:0 4px 16px rgba(0,0,0,0.25);
}
header h1{margin:0;font-weight:700;font-size:1.5em;}
header span{font-size:0.9em;opacity:0.9;}
.toggle{
  background:rgba(255,255,255,0.2);
  color:white;
  border:none;
  border-radius:20px;
  padding:6px 14px;
  cursor:pointer;
  font-weight:600;
  transition:0.3s;
}
.toggle:hover{background:rgba(255,255,255,0.3);}
main{
  flex:1;
  display:grid;
  grid-template-columns:360px 1fr;
  gap:20px;
  padding:20px;
}
@media(max-width:900px){main{grid-template-columns:1fr;}}
.panel{
  background:var(--panel);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:0 4px 20px rgba(0,0,0,0.15);
  transition:background 0.3s,box-shadow 0.3s;
}
label{font-weight:600;}
textarea{
  width:100%;height:130px;
  margin-top:8px;
  font-family:monospace;
  border-radius:var(--radius);
  border:1px solid var(--border);
  background:var(--tape-bg);
  color:var(--text);
  padding:10px;
  resize:none;
  transition:background 0.3s,color 0.3s,border 0.3s;
}
.controls{
  display:flex;flex-wrap:wrap;gap:10px;margin-top:14px;
}
button{
  background:var(--primary);
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  transition:0.25s;
}
button:hover{background:#1d4ed8;transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,0.2);}
button.reset{background:#dc2626;}
.visual{display:flex;flex-direction:column;height:100%;}
.tape-container{
  flex:1;
  background:var(--tape-bg);
  border-radius:var(--radius);
  padding:20px;
  overflow-x:auto;
  white-space:nowrap;
  box-shadow:inset 0 0 8px rgba(0,0,0,0.15);
  transition:background 0.3s;
}
.cell{
  display:inline-flex;
  justify-content:center;
  align-items:center;
  width:36px;
  height:36px;
  margin:2px;
  background:var(--cell);
  border:1px solid var(--border);
  border-radius:8px;
  font-weight:600;
  transition:all 0.25s;
}
.cell.head{
  background:var(--head);
  color:#fff;
  transform:scale(1.1);
  box-shadow:0 0 8px var(--accent);
}
.status{
  margin-top:14px;
  padding:10px 14px;
  border:1px solid var(--border);
  border-radius:10px;
  font-weight:600;
  background:var(--card);
}
.log{
  margin-top:12px;
  background:var(--log-bg);
  color:var(--log-text);
  border-radius:10px;
  padding:12px;
  height:160px;
  overflow-y:auto;
  font-family:monospace;
  font-size:13px;
  transition:background 0.3s,color 0.3s;
}
footer{
  text-align:center;
  color:var(--muted);
  font-size:13px;
  padding:12px;
  border-top:1px solid var(--border);
}
</style>
</head>
<body>
<header>
  <div>
    <h1>Multi-Tape Turing Machine Visualizer</h1>
    <span>Visualize theoretical computation step by step</span>
  </div>
  <button class="toggle" id="modeToggle">üåô Dark Mode</button>
</header>

<main>
  <section class="panel">
    <label>Encoding Type:</label><br/>
    <select id="encType"><option value="readable">Readable</option></select>

    <label style="display:block;margin-top:10px;">Encoding Input:</label>
    <textarea id="encodingInput" placeholder="Paste encoded TM+input here..."></textarea>

    <div class="controls">
      <button id="loadBtn">Load</button>
      <button id="stepBtn">Step</button>
      <button id="runBtn">Run</button>
      <button id="resetBtn" class="reset">Reset</button>
    </div>
  </section>

  <section class="panel visual">
    <h3 style="margin:0 0 10px;">Visualization</h3>
    <div id="tapesArea" class="tape-container"></div>
    <div id="statusBox" class="status">State: - | Steps: 0</div>
    <div id="log" class="log"></div>
  </section>
</main>

<footer>¬© 2025 Multi-Tape Turing Machine Visualizer | Designed By Lance and Ethan</footer>

<script>
// --- THEME TOGGLE ---
const toggleBtn = document.getElementById('modeToggle');
toggleBtn.addEventListener('click',()=>{
  document.body.classList.toggle('dark');
  const dark = document.body.classList.contains('dark');
  toggleBtn.textContent = dark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
});

// --- TM PARSER + LOGIC ---
function parseReadable(enc){
  const [left,right] = enc.split('###');
  const parts = left.split('||');
  if(parts.length < 9) throw new Error('Invalid readable encoding');
  const num_tapes=parseInt(parts[0]);
  const states=parts[1].split(',');
  const tape_alph=parts[3].split(',');
  const blank=parts[4];
  const start=parts[5];
  const accept=parts[6].split(',');
  const reject=parts[7].split(',');
  const transitions_raw=parts[8];
  const transitions={};
  transitions_raw.split('/').forEach(t=>{
    if(!t.includes('->')) return;
    const [L,R]=t.split('->');
    const Lp=L.split('%');
    const st=Lp[0];
    const read=Lp.slice(1);
    const Rp=R.split('%');
    const nst=Rp[0];
    const writes=Rp.slice(1,1+read.length);
    const moves=Rp.slice(1+read.length,1+read.length+read.length);
    transitions[st+'|'+read.join('|')]={newstate:nst,writes,moves};
  });
  const input_tapes=right?right.split('|'):new Array(num_tapes).fill('');
  return {num_tapes,states,tape_alph,blank,start,accept,reject,transitions,input_tapes};
}

let stateObj=null,autoTimer=null;
const tapesArea=document.getElementById('tapesArea');
const logEl=document.getElementById('log');
const statusBox=document.getElementById('statusBox');

function log(msg){logEl.textContent=`[${new Date().toLocaleTimeString()}] ${msg}\n`+logEl.textContent;}

function render(tm,tapes,heads){
  tapesArea.innerHTML='';
  for(let i=0;i<tm.num_tapes;i++){
    const row=document.createElement('div');
    row.textContent=`Tape ${i}: `;
    for(let j=0;j<tapes[i].length;j++){
      const c=document.createElement('span');
      c.className='cell'+(j===heads[i]?' head':'');
      c.textContent=tapes[i][j];
      row.appendChild(c);
    }
    tapesArea.appendChild(row);
  }
  statusBox.textContent=`State: ${stateObj.state} | Steps: ${stateObj.steps}`;
}

function loadTM(){
  const enc=document.getElementById('encodingInput').value.trim();
  if(!enc){alert('Paste an encoding first');return;}
  try{
    const parsed=parseReadable(enc);
    const tapes=parsed.input_tapes.map(t=>('_'+t+'_').split(''));
    const heads=parsed.input_tapes.map(_=>1);
    stateObj={tm:parsed,tapes,heads,state:parsed.start,steps:0,halted:false};
    render(parsed,tapes,heads);
    log('Loaded TM successfully');
  }catch(e){alert('Invalid code format: '+e.message);}
}

function stepOnce(){
  if(!stateObj){alert('Load a TM first');return;}
  const tm=stateObj.tm,tapes=stateObj.tapes,heads=stateObj.heads;
  const T=tm.num_tapes;
  const read=[];
  for(let i=0;i<T;i++) read.push(tapes[i][heads[i]]);
  const key=stateObj.state+'|'+read.join('|');
  const trans=tm.transitions[key];
  if(!trans){stateObj.halted=true;log(`No transition for ${key}. HALT.`);return;}
  for(let i=0;i<T;i++)tapes[i][heads[i]]=trans.writes[i];
  stateObj.state=trans.newstate;
  for(let i=0;i<T;i++){
    const m=trans.moves[i];
    if(m==='R'){heads[i]++;if(heads[i]>=tapes[i].length)tapes[i].push(tm.blank);}
    else if(m==='L'){heads[i]--;if(heads[i]<0){tapes[i].unshift(tm.blank);heads[i]=0;}}
  }
  stateObj.steps++;
  render(tm,tapes,heads);
  log(`Step ${stateObj.steps}: ${key} -> ${trans.newstate}`);
  if(tm.accept.includes(stateObj.state)){log('‚úîÔ∏è ACCEPTED');stateObj.halted=true;}
}

document.getElementById('loadBtn').onclick=loadTM;
document.getElementById('stepBtn').onclick=()=>{if(!stateObj?.halted)stepOnce();};
document.getElementById('runBtn').onclick=()=>{if(!stateObj)return;autoTimer=setInterval(()=>{if(!stateObj.halted)stepOnce();else clearInterval(autoTimer);},250);};
document.getElementById('resetBtn').onclick=()=>{stateObj=null;tapesArea.innerHTML='';statusBox.textContent='State: - | Steps: 0';log('Reset');};
</script>
</body>
</html>
